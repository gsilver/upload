<!-- based on: http://www.matlus.com/html5-file-upload-with-progress/ -->
<html ng-app="myApp">

<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="upload.css">

  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.9/angular.min.js"></script>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.9/angular-animate.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
  <script type="text/javascript" src="upload.js"></script>
</head>

<body>
  <div ng-controller="myCtrl" class="container-fluid">
    <p>selected function is : {{selectedFunction.name}}</p>
    <p>function id is : {{selectedFunction.id}} </p>
    <p>fields:{{selectedFunction.fields}} </p>
    <p>type:{{selectedFunction.type}} </p>
    <label for="selectFunction">Select a task</label>
    <select id="selectFunction" ng-model="selectedFunction" ng-options="function.name for function in functions" ng-change="changeSelectedFunction(selectedFunction)">
      <option style="display:none" value="">Select a function</option>
    </select>
    <br><br>
    <div class="" ng-show="selectedFunction.type==='csv'">
      CSV Model: <span  ng-repeat ="field in selectedFunction.fields_model"><span class="label label-default">{{field}}</span> </span>
      <br><br>
      <form class="form-inline">
        <div class="form-group">
          <div class="input-group">
            <input type="file" type="file" file-model="csvfile">
          </div>
        </div>
        <span ng-show="loading" class="alert alert-info">Loading...</span>
        <button ng-show="content" class="btn btn-default" type="reset" ng-click="content=[]" name="reset-file-input">Reset</button>
      </form>

      <div class="" ng-show="content">
        <button class="btn btn-primary" ng-click="uploadForm()">Upload</button>
      </div>
      <div class="alert alert-danger" ng-show="errors.length && content.length">
        <span ng-if="errors.length >1">There were {{errors.length}} errors</span><span ng-if="errors.length ===1">There was {{errors.length}} error</span>, highlighted below. <input type="checkbox" id="showErrors" name="" value="" ng-model="showErrors">        <label for="showErrors">Show errors only</label>
      </div>
      <table class="table table-striped  table-hover" ng-show="content">
        <thead>
          <tr>
            <!-- <th ng-repeat="header in headers">
              {{header}} -->
              <!-- <a href="#" ng-click="sortType = 'Id';sortReverse = !sortReverse">
                Id
                <span ng-show="sortType == 'Id' && !sortReverse" class="fa fa-caret-down"></span>
                <span ng-show="sortType == 'Id' && sortReverse" class="fa fa-caret-up"></span>
              </a>
            </th>
            <th>
              <a href="#" ng-click="sortType = 'Role';sortReverse = !sortReverse">
                Role
                <span ng-show="sortType == 'Role' && !sortReverse" class="fa fa-caret-down"></span>
                <span ng-show="sortType == 'Role' && sortReverse" class="fa fa-caret-up"></span>
              </a>
            </th>
            <th>

              <a href="#" ng-click="sortType = 'Section';sortReverse = !sortReverse">
                Section
                <span ng-show="sortType == 'Section' && !sortReverse" class="fa fa-caret-down"></span>
                <span ng-show="sortType == 'Section' && sortReverse" class="fa fa-caret-up"></span>
              </a>

            </th>
            <th>

              <a href="#" ng-click="sortType = 'Status';sortReverse = !sortReverse">
                Status
                <span ng-show="sortType == 'Status' && !sortReverse" class="fa fa-caret-down"></span>
                <span ng-show="sortType == 'Status' && sortReverse" class="fa fa-caret-up"></span>
              </a> -->



            <th ng-repeat="header in headers">
                {{header}}
            </th>
          </tr>
        </thead>
        <tbody>
          <tr ng-hide="showErrors && !contentline.invalid" ng-class="{ 'table-danger': contentline.invalid}" ng-repeat="contentline in content | orderBy:sortType:sortReverse track by $index">
            <td ng-repeat="item in contentline.data">
              {{item}}
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <table class="table table-striped  table-hover" ng-show="selectedFunction.type==='grid'" style="width:auto">
      <tr ng-repeat="i in getNumber(gridRowNumber) track by $index">
        <td ng-repeat="field in selectedFunction.fields track by $index">
          <input type="text" class="form-control" name="" value="" placeholder="{{field}}">
        </td>
      </tr>
    </table>
  </div>
</body>

</html>
